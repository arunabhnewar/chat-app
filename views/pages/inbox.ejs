<%- include('../partials/header.ejs'); %>

<div id="chat-container">
  <div id="search-container">
    <input type="text" placeholder="Search" />
  </div>

  <div id="conversation-list">
    <% data.forEach(function(conversation) { %>
    <!-- conversation creator is same to logged in user, so we need to show participant name and avatar -->
    <% if(conversation.creator.id == loggedInUser.userid) { %>
    <div class="conversation" onclick="getMessages('<%= conversation._id %>', '<%= conversation.participant.name %>')">
      <% if (conversation.participant.avatar) { %>
      <img src="./uploads/avatars/<%= conversation.participant.avatar %>" alt="<%= conversation.participant.name %>" />
      <% } else { %>
      <img src="./assets/nophoto.png" />
      <% } %>
      <div class="title-text"><%= conversation.participant.name %></div>
      <div class="conversation-date">Apr 01</div>
    </div>
    <% } else { %>
    <div class="conversation" onclick="getMessages('<%= conversation._id %>', '<%= conversation.creator.name %>')">
      <% if (conversation.creator.avatar) { %>
      <img src="./uploads/avatars/<%= conversation.creator.avatar %>" alt="<%= conversation.creator.name %>" />
      <% } else { %>
      <img src="./assets/nophoto.png" />
      <% } %>
      <div class="title-text"><%= conversation.creator.name %></div>
      <div class="conversation-date">Apr 01</div>
    </div>
    <% } %>
    <% }); %>

    <!-- show no conversation placeholder image for 0 conversations -->
    <% if(data && data.length === 0) { %>
    <div class="nothing"><img src="./assets/no-conversation.svg"></div>
    <% } %>
  </div>

  <div class="new-message-container" onclick="openModal()">
    <a href="#">+</a>
  </div>

  <div id="chat-title">
    <span id="conversation-partner"></span>
    <img src="./assets/trash.png" alt="Delete Conversation" />
  </div>

  <!-- placeholder div if no messages are in messages area -->
  <div id="chat-message-list">
    <div class="nothing">select a conversation</div>
  </div>

  <!-- send message form -->
  <form id="chat-form" method="post" enctype="multipart/form-data">
    <label for="attachment"><img src="./assets/attachment.png" alt="Add Attachment" /></label>
    <input type="file" multiple name="attachment" class="hide" id="attachment" />
    <input type="text" name="message" placeholder="Type a message" autocomplete="off" />
  </form>

</div>

<%- include('../partials/add-conversation-modal.ejs')  %>

<!-- import socket io client from cdn -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/3.1.3/socket.io.min.js"></script>

</body>

</html>